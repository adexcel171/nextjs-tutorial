{"version":3,"sources":["../../../../src/server/lib/trace/tracer.ts"],"names":["NextVanillaSpanAllowlist","api","require","err","context","trace","SpanStatusCode","SpanKind","isPromise","p","then","closeSpanWithError","span","error","recordException","setStatus","code","ERROR","message","end","rootSpanAttributesStore","Map","rootSpanIdKey","createContextKey","lastSpanId","getSpanId","NextTracerImpl","getTracerInstance","getTracer","getContext","getActiveScopeSpan","getSpan","active","args","type","fnOrOptions","fnOrEmpty","fn","options","includes","process","env","NEXT_OTEL_VERBOSE","hideSpan","spanName","spanContext","getSpanContext","parentSpan","isRootSpan","ROOT_CONTEXT","spanId","attributes","with","setValue","startActiveSpan","onCleanup","delete","set","Object","entries","length","result","finally","wrap","tracer","name","optionsObj","apply","arguments","lastArgId","cb","scopeBoundCb","bind","_span","done","startSpan","setSpan","undefined","getRootSpanAttributes","getValue","get"],"mappings":"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"}